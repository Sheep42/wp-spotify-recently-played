"use strict";!function(t){var a=t(document),e=t(window),n=t("#ds-spotify-recently-played-container"),r=t("#ds-spotify-recently-played-toggle"),i=t("#ds-spotify-recently-played"),o=t("#footer");function s(){var t=e.height()+e.scrollTop(),a=o.offset().top,r=t>=a?t-a-1:0;n.hasClass("expanded")||(r-=i.outerHeight()),0!==r&&(r+="px"),n.css({bottom:r})}function c(a,e){var n='\n\t\t\t<input type="hidden" class="track-id" value="'.concat(a.id,'" />\n\t\t\t\n\t\t\t<div class="track-name">\n\t\t\t\t<a href="').concat(a.external_urls.spotify,'" target="_blank">').concat(a.name,'</a>\n\t\t\t</div>\n\n\t\t\t<div class="artist-name">\n\t\t\t\t<a href="').concat(a.artists[0].external_urls.spotify,'" target="_blank">').concat(a.artists[0].name,'</a>\n\t\t\t</div> &ndash; <div class="album-name">\n\t\t\t\t<a href="').concat(a.album.external_urls.spotify,'" target="_blank">').concat(a.album.name,"</a>\n\t\t\t</div>\n\t\t");if(void 0!==e){var r=function(t,a){var e=t.getTime()-a.getTime(),n=Math.floor(e/1e3/60/60/24);e-=1e3*n*60*60*24;var r=Math.floor(e/1e3/60/60);e-=1e3*r*60*60;var i=Math.floor(e/1e3/60);e-=1e3*i*60;var o=Math.floor(e/1e3);return{days:n,hours:r,minutes:i,seconds:o}}(new Date,new Date(e));for(var i in r)if(0!=r[i]){var o=r[i]>1?i:i.substring(0,i.length-1);n+='\n\t\t\t\t\t<div class="played-at">'.concat(r[i]," ").concat(o," ago</div>\n\t\t\t\t");break}}return t.parseHTML(n)}a.ready(function(){n.css({bottom:-(i.outerHeight()+1)+"px"}),r.on("click",function(a){a.preventDefault();t(this);var r=e.height()+e.scrollTop(),s=o.offset().top,c=r>=s?r-s-1:0;n.hasClass("expanded")?(c-=i.outerHeight(),n.removeClass("expanded")):n.addClass("expanded"),0!==c&&(c+="px"),n.stop().animate({bottom:c})});var a=function(){var a={__srp_nonce:ajax_object.srp_get_track_info_nonce,action:"get_spotify_track_info"};t.post(ajax_object.ajax_url,a,function(a){!1===a.success&&(console.error(a.data.message),clearInterval(l),n.hide());var e=JSON.parse(a.data);null==e.current_track&&null==e.recent_tracks&&n.is(":visible")&&n.hide(),function(t){var a=i.find(".current-track"),e=a.find(".track");if(null==t)return void a.fadeOut(400,function(){e.html(""),s()});if(a.find(".track-id").val()==t.item.id)return;var n=c(t.item);e.fadeOut(400,function(){e.html(n),e.show(),s(),e.hide(),e.fadeIn(400,function(){a.is(":visible")||(a.show(),s(),a.hide(),a.fadeIn())})})}(e.current_track),function(a){var e=i.find(".recently-played"),n=e.find(".track-list");if(null==a)return void e.fadeOut(400,function(){n.html(""),s()});var r=e.find(".track-id").first().val(),o=[];if(a.items.forEach(function(a,e){var n=c(a.track,a.played_at),r=t.parseHTML('<li class="track"></li>');t(r).html(n),o.push(r)}),r==a.items[0].track.id){n.html("");for(var l=0;l<o.length;l++)n.append(o[l])}else n.fadeOut(400,function(){n.html("");for(var t=0;t<o.length;t++)n.append(o[t]);n.show(),s(),n.hide(),n.fadeIn(400,function(){e.is(":visible")||(e.show(),s(),e.hide(),e.fadeIn())})})}(e.recent_tracks)})},l=setInterval(a,1e3*10);a()}),e.on("scroll",s)}(jQuery);